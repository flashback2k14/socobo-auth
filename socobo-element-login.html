<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-input-char-counter.html">

<!--
The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--socobo-element-login-container-theme` | Styling Container that holds all Elements | `{}`
`--socobo-element-login-label-container-theme` | Styling Headline Label Container | `{}`
`--socobo-element-login-label-text-theme` | Styling Headline Label | `{}`
`--socobo-element-login-social-button-container-theme` | Styling Social Button Container | `{}`
`--socobo-element-login-social-btn-theme` | Styling for all Social Buttons | `{}`
`--socobo-element-login-btn-google-plus-theme` | Styling Google+ Button | `{}`
`--socobo-element-login-btn-twitter-theme` | Styling Twitter Button | `{}`
`--socobo-element-login-btn-facebook-theme` | Styling Facebook Button | `{}`
`--socobo-element-login-btn-login-email-theme` | Styling Login Button | `{}`
`--socobo-element-login-login-input-container-theme` | Styling Input Element Container | `{}`
`--socobo-element-login-register-container-theme` | Styling Hyperlink to Register Element container | `{}`

@demo demo/index.html
-->
<dom-module id="socobo-element-login">
  <style>
    :host {
      display: block;
    }
    .container {
      width: 100%;
      height: 100%;
      @apply(--socobo-element-login-container-theme)
    }
    .label-container {
      width: 100%;
      clear: both;
      background-color: #304FFE;
      @apply(--socobo-element-login-label-container-theme)
    }
    .label-text {
      margin: 0;
      padding: 20px 0 10px 5px;
      @apply(--socobo-element-login-label-text-theme);
    }
    .social-button-container {
      width: 40%;
      float: left;
      margin-top: 50px;
      @apply(--socobo-element-login-social-button-container-theme)
    }
    .social-btn {
      margin-left: 15px;
      margin-bottom: 5px;
      width: 150px;
      @apply(--socobo-element-login-social-btn-theme)
    }
    .btn-google-plus {
      color: #ffffff;
      background-color: #dd4b39;
      @apply(--socobo-element-login-btn-google-plus-theme)
    }
    .btn-twitter {
      color: #ffffff;
      background-color: #55acee;
      @apply(--socobo-element-login-btn-twitter-theme)
    }
    .btn-facebook {
      color: #ffffff;
      background-color: #3b5998;
      @apply(--socobo-element-login-btn-facebook-theme)
    }
    .btn-login-email {
      float: right;
      margin-top: 20px;
      width: 150px;
      color: #ffffff;
      background-color: #388E3C;
      @apply(--socobo-element-login-btn-login-email-theme)
    }
    .login-input-container {
      width: 55%;
      float: right;
      margin-top: 55px;
      margin-right: 15px;
      @apply(--socobo-element-login-login-input-container-theme)
    }
    .register-container {
      width: 50%;
      clear: left;
      padding-top: 42px;
      padding-left: 17px;
      padding-bottom: 10px;
      white-space: nowrap;
      @apply(--socobo-element-login-register-container-theme)
    }
  </style>

  <template>
    <div class="container">

      <div class="label-container">
        <paper-material elevation="3" animated="true">
          <paper-toolbar>
            <h1 class="label-text">Login</h1>
          </paper-toolbar>
        </paper-material>
      </div>

      <div class="social-button-container">
        <paper-button
          class="social-btn btn-google-plus"
          raised
          on-click="loginWithGooglePlus">Google+
        </paper-button>
        <paper-button
          class="social-btn btn-twitter"
          raised
          on-click="loginWithTwitter">Twitter
        </paper-button>
        <paper-button
          class="social-btn btn-facebook"
          raised
          on-click="loginWithFacebook">Facebook
        </paper-button>
      </div>

      <div class="login-input-container">
        <paper-input
          id="txtEmailaddress"
          label="E-Mail Address"
          type="email"
          auto-validate
          pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
          error-message="no valid emailaddress">
        </paper-input>
        <paper-input
          id="txtPassword"
          label="Password"
          type="password"
          char-counter auto-validate
          pattern="[a-zA-Z0-9]*"
          minlength="8"
          maxlength="30"
          error-message="min. 8 character (only letters, numbers)">
        </paper-input>
        <paper-button
          class="btn-login-email"
          raised
          on-click="loginWithEmail">Login
        </paper-button>
      </div>

      <div class="register-container">
        <a href="#" on-click="goToRegister">No Account, yet? Register here...</a>
      </div>

    </div>
  </template>
</dom-module>

<script>
  (function() {
    Polymer({
      is: 'socobo-element-login',

      /**
       * Method for login with Google+ Account
       *
       * @method loginWithGooglePlus
       */
      loginWithGooglePlus: function() {
        this.handleLogin('google');
      },

      /**
       * Method for login with Twitter Account
       *
       * @method loginWithTwitter
       */
      loginWithTwitter: function() {
        this.handleLogin('twitter');
      },

      /**
       * Method for login with Facebook Account
       *
       * @method loginWithFacebook
       */
      loginWithFacebook: function() {
        this.handleLogin('facebook');
      },

      /**
       * Method for login with Emailaddress Account
       *
       * @method loginWithEmail
       */
      loginWithEmail: function() {
        this.handleLogin('email');
      },

      /**
       * Method for go to Register Element <br/>
       * __CUSTOM EVENT:__ go-to-register
       *
       * @method goToRegister
       */
      goToRegister: function() {
        this.fire('go-to-register');
      },

      /**
       * Method for clearing all input fields
       *
       * @param {Boolean} clearAll
       * @method clearInputFields
       */
      clearInputFields: function(clearAll) {
        if (clearAll) this.$.txtEmailaddress.value = "";
        this.$.txtPassword.value = "";
      },

      /**
       * Method for handle user login <br/>
       * __CUSTOM EVENT:__ login-successful <br/>
       * __CUSTOM EVENT:__ login-failed
       *
       * @param {String} provider Social Provider
       * @method handleLogin
       */
      handleLogin: function(provider) {
        var that = this;
        if (provider === 'email') {
          var emailAddress = this.$.txtEmailaddress.value;
          var password = this.$.txtPassword.value;

          var userObj = {
            'email': emailAddress,
            'password': password
          };

          SocoboAuth.loginWithEmailaddress(userObj, false)
            .then(function(user) {
              that.clearInputFields(true);
              that.fire('login-successful', user);
            })
            .catch(function(err) {
              that.clearInputFields(false)
              that.fire('login-failed', err);
            });

        } else {
          SocoboAuth.loginWithProvider(provider, false)
            .then(function(user) {
              that.clearInputFields(true);
              that.fire('login-successful', user);
            })
            .catch(function(err) {
              that.clearInputFields(false);
              that.fire('login-failed', err);
            });
        }
      },

      ready: function() {
        console.log('Login Element is ready to rock!');
      }
    });
  })();
</script>
